<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i: Ai l√† ng∆∞·ªùi k·ªÉ chuy·ªán?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0fdf4;
        }
        .btn-option {
            transition: all 0.2s;
            cursor: pointer;
        }
        .btn-option:active {
            transform: scale(0.95);
        }
        .correct {
            background-color: #4ade80 !important;
            color: white !important;
            border-color: #22c55e !important;
            animation: celebrate 0.5s ease;
        }
        .incorrect {
            background-color: #f87171 !important;
            color: white !important;
            border-color: #ef4444 !important;
        }
        .hidden {
            display: none;
        }
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .victory-bg {
            background: linear-gradient(135deg, #fdf9f0 0%, #fff7ed 100%);
            border: 4px dashed #fbbf24;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <!-- √Çm thanh hi·ªáu ·ª©ng -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-error" src="https://assets.mixkit.co/active_storage/sfx/2357/2357-preview.mp3"></audio>
    
    <!-- Nh·∫°c n·ªÅn ch√∫c m·ª´ng (B·∫£n nh·∫°c vui nh·ªôn, d√†i h∆°n) -->
    <audio id="sound-victory-loop" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" loop></audio>

    <div class="max-w-3xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden border-4 border-green-200">
        <!-- Header -->
        <div class="bg-green-500 p-6 text-white text-center">
            <h1 class="text-3xl font-bold mb-2">üçé Ai l√† ng∆∞·ªùi k·ªÉ chuy·ªán? üçé</h1>
            <p class="text-lg opacity-90">D·ª±a theo c√¢u chuy·ªán c·ªï t√≠ch "C√¢y kh·∫ø"</p>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 h-2">
            <div id="progress" class="bg-yellow-400 h-2 transition-all duration-500" style="width: 0%"></div>
        </div>

        <!-- Game Content -->
        <div class="p-6 md:p-10">
            
            <!-- ƒê·ªÅ b√†i -->
            <div id="intro-screen" class="text-center">
                <div class="mb-6">
                    <span class="text-5xl">üìñ</span>
                </div>
                <h2 class="text-2xl font-bold text-green-700 mb-4">Ch√†o m·ª´ng c√°c em!</h2>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 text-left">
                    <p class="font-bold text-yellow-700">ƒê·ªÅ b√†i:</p>
                    <p class="text-lg text-gray-700 italic">‚ÄúH√£y k·ªÉ l·∫°i c√¢u chuy·ªán ‚ÄòC√¢y kh·∫ø‚Äô theo l·ªùi c·ªßa ng∆∞·ªùi em.‚Äù</p>
                </div>
                <p class="text-gray-600 mb-8">Ch√∫ng m√¨nh c√πng th·ª±c hi·ªán c√°c nhi·ªám v·ª• ƒë·ªÉ chu·∫©n b·ªã k·ªÉ chuy·ªán th·∫≠t hay nh√©!</p>
                <button onclick="startGame()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full text-xl shadow-lg btn-option">B·∫Øt ƒë·∫ßu ngay</button>
            </div>

            <!-- Nhi·ªám v·ª• 1 & 2 -->
            <div id="task-1-2" class="hidden">
                <div id="q1">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Nhi·ªám v·ª• 1: Trong ƒë·ªÅ b√†i tr√™n, ai l√† ng∆∞·ªùi k·ªÉ chuy·ªán?</h3>
                    <div class="grid gap-4">
                        <button onclick="checkAnswer(1, 'A', this)" class="btn-option w-full text-left p-4 border-2 border-gray-200 rounded-xl hover:border-green-400 font-medium text-gray-700">A. Ng∆∞·ªùi anh</button>
                        <button onclick="checkAnswer(1, 'B', this)" class="btn-option w-full text-left p-4 border-2 border-gray-200 rounded-xl hover:border-green-400 font-medium text-gray-700">B. Ng∆∞·ªùi em</button>
                        <button onclick="checkAnswer(1, 'C', this)" class="btn-option w-full text-left p-4 border-2 border-gray-200 rounded-xl hover:border-green-400 font-medium text-gray-700">C. Con chim th·∫ßn</button>
                    </div>
                </div>

                <div id="q2" class="hidden mt-10">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Nhi·ªám v·ª• 2: Khi k·ªÉ chuy·ªán, ng∆∞·ªùi em s·∫Ω x∆∞ng l√† g√¨?</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="checkAnswer(2, 'A', this)" class="btn-option p-4 border-2 border-gray-200 rounded-xl hover:border-blue-400 font-medium text-gray-700">A. T√¥i (ho·∫∑c Em)</button>
                        <button onclick="checkAnswer(2, 'B', this)" class="btn-option p-4 border-2 border-gray-200 rounded-xl hover:border-blue-400 font-medium text-gray-700">B. Anh ·∫•y</button>
                    </div>
                </div>

                <div id="next-btn-container" class="hidden mt-8 text-center">
                    <button onclick="goToTask3()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg btn-option">Ti·∫øp t·ª•c nhi·ªám v·ª• 3 ‚ûî</button>
                </div>
            </div>

            <!-- Nhi·ªám v·ª• 3 -->
            <div id="task-3" class="hidden">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Nhi·ªám v·ª• 3: Ph√¢n bi·ªát c√¢u k·ªÉ ƒê√∫ng v√† Ch∆∞a ƒë√∫ng</h3>
                <p class="text-gray-600 mb-6">Em h√£y ch·ªçn nh·ªØng c√¢u k·ªÉ ƒë√∫ng theo l·ªùi c·ªßa <b>ng∆∞·ªùi em</b> nh√©!</p>
                
                <div id="sorting-area" class="space-y-4">
                    <div class="p-4 border-2 border-purple-100 rounded-2xl bg-purple-50">
                        <p class="mb-3 font-medium text-gray-700 font-bold">C√¢u 1: N√≥i v·ªÅ vi·ªác chia gia t√†i</p>
                        <div class="flex flex-col gap-2">
                            <button onclick="checkTask3(0, true, this)" class="text-left p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700">"Sau khi cha m·∫π qua ƒë·ªùi, v·ª£ ch·ªìng ng∆∞·ªùi anh chia gia t√†i, <b>t√¥i</b> ch·ªâ ƒë∆∞·ª£c m·ªôt m·∫£nh v∆∞·ªùn nh·ªè c√≥ c√¢y kh·∫ø."</button>
                            <button onclick="checkTask3(0, false, this)" class="text-left p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700">"Sau khi cha m·∫π qua ƒë·ªùi, ng∆∞·ªùi anh chia gia t√†i, <b>ng∆∞·ªùi em</b> ch·ªâ ƒë∆∞·ª£c m·ªôt c√¢y kh·∫ø."</button>
                        </div>
                    </div>

                    <div class="p-4 border-2 border-purple-100 rounded-2xl bg-purple-50">
                        <p class="mb-3 font-medium text-gray-700 font-bold">C√¢u 2: N√≥i v·ªÅ vi·ªác chim ƒë·∫øn ƒÉn kh·∫ø</p>
                        <div class="flex flex-col gap-2">
                            <button onclick="checkTask3(1, false, this)" class="text-left p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700">"M·ªôt h√¥m, c√≥ con chim l·∫° ƒë·∫øn ƒÉn kh·∫ø. <b>Ng∆∞·ªùi em</b> bu·ªìn r·∫ßu b·∫£o chim ƒë·ª´ng ƒÉn."</button>
                            <button onclick="checkTask3(1, true, this)" class="text-left p-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700">"M·ªôt h√¥m, th·∫•y chim ƒë·∫øn ƒÉn kh·∫ø, <b>t√¥i</b> lo l·∫Øng th∆∞a v·ªõi chim r·∫±ng nh√† <b>t√¥i</b> ch·ªâ c√≥ m·ªói c√¢y kh·∫ø n√†y th√¥i."</button>
                        </div>
                    </div>
                </div>

                <div id="finish-btn-container" class="hidden mt-8 text-center">
                    <button onclick="showVictory()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full shadow-lg btn-option">Ho√†n th√†nh tr√≤ ch∆°i üéâ</button>
                </div>
            </div>

            <!-- M√†n h√¨nh k·∫øt th√∫c -->
            <div id="victory-screen" class="hidden text-center victory-bg p-8 rounded-3xl">
                <div class="mb-6 relative">
                    <span class="text-7xl animate-bounce inline-block">üèÜ</span>
                    <span class="absolute -top-4 left-1/4 text-3xl animate-pulse">üéä</span>
                    <span class="absolute -top-4 right-1/4 text-3xl animate-pulse">üéâ</span>
                </div>
                <h2 class="text-3xl font-bold text-yellow-600 mb-4">TUY·ªÜT V·ªúI!</h2>
                <p class="text-xl text-gray-700 mb-6 font-semibold">Em ƒë√£ xu·∫•t s·∫Øc ho√†n th√†nh t·∫•t c·∫£ nhi·ªám v·ª•!</p>
                
                <div class="bg-white p-6 rounded-2xl mb-8 border-2 border-yellow-200 shadow-sm text-left">
                    <p class="text-lg font-bold text-green-700 mb-3 border-b pb-2">üåü Ghi nh·ªõ ƒë·ªÉ k·ªÉ chuy·ªán hay:</p>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex items-center gap-2">
                            <span class="text-green-500 font-bold">‚úì</span> 
                            <span>ƒê√≥ng vai nh√¢n v·∫≠t: <b>Ng∆∞·ªùi em</b></span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-500 font-bold">‚úì</span> 
                            <span>C√°ch x∆∞ng h√¥: <b>T√¥i</b> ho·∫∑c <b>Em</b></span>
                        </li>
                        <li class="flex items-center gap-2">
                            <span class="text-green-500 font-bold">‚úì</span> 
                            <span>Thay ƒë·ªïi t·ª´ "ng∆∞·ªùi em" th√†nh "t√¥i" trong m·ªçi t√¨nh hu·ªëng.</span>
                        </li>
                    </ul>
                </div>

                <div class="flex flex-col gap-4 items-center">
                    <button id="toggle-music" onclick="toggleVictoryMusic()" class="bg-white border-2 border-yellow-500 text-yellow-600 font-bold py-2 px-6 rounded-full hover:bg-yellow-50 btn-option flex items-center gap-2">
                        <span id="music-icon">üîá</span> <span id="music-text">T·∫Øt nh·∫°c</span>
                    </button>
                    <button onclick="location.reload()" class="text-gray-500 font-medium hover:text-green-600 transition-colors">Ch∆°i l·∫°i t·ª´ ƒë·∫ßu ‚Ü∫</button>
                </div>
            </div>

        </div>

        <div id="message-box" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full shadow-2xl text-white font-bold hidden opacity-0 transition-opacity duration-300">
        </div>
    </div>

    <script>
        function playSound(id) {
            const sound = document.getElementById(id);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log("Audio play blocked"));
            }
        }

        function toggleVictoryMusic() {
            const victoryMusic = document.getElementById('sound-victory-loop');
            const musicText = document.getElementById('music-text');
            const musicIcon = document.getElementById('music-icon');
            
            if (victoryMusic.paused) {
                victoryMusic.play();
                musicText.innerText = "T·∫Øt nh·∫°c";
                musicIcon.innerText = "üîá";
            } else {
                victoryMusic.pause();
                musicText.innerText = "B·∫≠t nh·∫°c";
                musicIcon.innerText = "üéµ";
            }
        }

        function showMessage(text, isCorrect) {
            const box = document.getElementById('message-box');
            box.textContent = text;
            box.className = `fixed bottom-10 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full shadow-2xl text-white font-bold transition-opacity duration-300 ${isCorrect ? 'bg-green-500' : 'bg-red-500'}`;
            box.classList.remove('hidden');
            setTimeout(() => box.style.opacity = '1', 10);
            
            if (isCorrect) playSound('sound-correct');
            else playSound('sound-error');

            setTimeout(() => {
                box.style.opacity = '0';
                setTimeout(() => box.classList.add('hidden'), 300);
            }, 2000);
        }

        function startGame() {
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('task-1-2').classList.remove('hidden');
            updateProgress(20);
        }

        function updateProgress(val) {
            document.getElementById('progress').style.width = val + '%';
        }

        function checkAnswer(questionNum, choice, element) {
            if (questionNum === 1) {
                if (choice === 'B') {
                    element.classList.add('correct');
                    disableButtons('q1');
                    showMessage('Ch√≠nh x√°c! Ng∆∞·ªùi em s·∫Ω l√† ng∆∞·ªùi k·ªÉ l·∫°i c√¢u chuy·ªán.', true);
                    document.getElementById('q2').classList.remove('hidden');
                    updateProgress(40);
                } else {
                    element.classList.add('incorrect');
                    showMessage('Th·ª≠ l·∫°i nh√©! ƒê·ªÅ b√†i y√™u c·∫ßu k·ªÉ theo l·ªùi c·ªßa ai n√†o?', false);
                }
            } else if (questionNum === 2) {
                if (choice === 'A') {
                    element.classList.add('correct');
                    disableButtons('q2');
                    showMessage('Gi·ªèi l·∫Øm! Khi t·ª± k·ªÉ v·ªÅ m√¨nh, ng∆∞·ªùi em x∆∞ng "t√¥i" ho·∫∑c "em".', true);
                    document.getElementById('next-btn-container').classList.remove('hidden');
                    updateProgress(60);
                } else {
                    element.classList.add('incorrect');
                    showMessage('N·∫øu x∆∞ng "Anh ·∫•y" th√¨ l√† ƒëang k·ªÉ v·ªÅ ng∆∞·ªùi kh√°c r·ªìi!', false);
                }
            }
        }

        function disableButtons(containerId) {
            const buttons = document.querySelectorAll(`#${containerId} button`);
            buttons.forEach(btn => btn.disabled = true);
        }

        function goToTask3() {
            document.getElementById('task-1-2').classList.add('hidden');
            document.getElementById('task-3').classList.remove('hidden');
            updateProgress(80);
        }

        function checkTask3(index, isCorrect, element) {
            const parent = element.parentElement;
            const buttons = parent.querySelectorAll('button');
            
            if (isCorrect) {
                element.classList.add('correct');
                showMessage('ƒê√∫ng r·ªìi! C√¢u n√†y ƒë√£ thay ƒë·ªïi ng√¥i k·ªÉ ph√π h·ª£p.', true);
            } else {
                element.classList.add('incorrect');
                showMessage('Ch∆∞a ƒë√∫ng. C√¢u n√†y v·∫´n ƒëang k·ªÉ ·ªü ng√¥i th·ª© ba (g·ªçi t√™n nh√¢n v·∫≠t).', false);
            }

            buttons.forEach(btn => {
                btn.disabled = true;
                if (!btn.classList.contains('correct') && !btn.classList.contains('incorrect')) {
                    btn.style.opacity = '0.5';
                }
            });

            if (document.querySelectorAll('#sorting-area button[disabled]').length === 4) {
                document.getElementById('finish-btn-container').classList.remove('hidden');
                updateProgress(100);
            }
        }

        function showVictory() {
            // Hi·ªÉn th·ªã m√†n h√¨nh chi·∫øn th·∫Øng
            document.getElementById('task-3').classList.add('hidden');
            document.getElementById('victory-screen').classList.remove('hidden');
            
            // T·ª± ƒë·ªông ph√°t nh·∫°c chi·∫øn th·∫Øng (ƒê√£ ƒë∆∞·ª£c loop)
            const victoryMusic = document.getElementById('sound-victory-loop');
            victoryMusic.volume = 0.6;
            victoryMusic.play().catch(e => {
                console.log("Auto-play blocked, user needs to interact first.");
                // N·∫øu b·ªã block, ƒë·ªïi nh√£n n√∫t th√†nh "B·∫≠t nh·∫°c"
                document.getElementById('music-text').innerText = "B·∫≠t nh·∫°c";
                document.getElementById('music-icon').innerText = "üéµ";
            });
        }
    </script>
</body>
</html>